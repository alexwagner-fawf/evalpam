% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/fct_sample_results_table.R
\name{sample_results_table}
\alias{sample_results_table}
\title{Prepare spectrogram input data}
\usage{
sample_results_table(
  confidence_selection_mode = "top",
  n_per_species = 30,
  deployment_ids,
  grouping_by = c("species_id", "deployment_id"),
  pool
)
}
\arguments{
\item{confidence_selection_mode}{Character string specifying how results
should be selected. One of:
\describe{
  \item{"top"}{Select the \code{n_per_species} highest-confidence detections per group.}
  \item{"random"}{Randomly sample \code{n_per_species} detections per group.}
  \item{"stratified"}{Sample detections stratified across equally-spaced confidence intervals, where number of intervals equals \code{n_per_species}}
}}

\item{n_per_species}{Integer. Number of detections to select per group.}

\item{deployment_ids}{Vector of deployment IDs used to filter audio files.}

\item{grouping_by}{Character vector specifying columns used for grouping.
Defaults to \code{c("species_id", "deployment_id")}.}

\item{pool}{A database connection pool (e.g. created with
\code{pool::dbPool()}).}
}
\value{
A tibble containing the selected detection results.
}
\description{
Selects detection results from the database to be used as input for
spectrogram generation. The selection can be based on highest confidence,
random sampling, or stratified sampling across confidence levels.
}
\details{
The function queries the `import.audio_files` and `import.results`
tables, filters by deployment IDs, groups the results according to
user-defined variables, and applies the chosen sampling strategy.


The function performs database-side grouping when possible and only
collects data into memory after sampling (except for stratified mode,
where sampling is performed locally).

Stratified sampling divides confidence values into
\code{n_per_species} bins and randomly selects one observation per bin.
}
\examples{
\dontrun{
prepare_spectrogram_input_data(
  confidence_selection_mode = "top",
  n_per_species = 30,
  deployment_ids = c(1, 2, 3),
  pool = pool
)
}

}
